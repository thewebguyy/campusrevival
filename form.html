<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add School or University - CRM Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary: #000000;
      --text: #000000;
      --bg: #ffffff;
      --gray: #f5f5f5;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    header {
      background-color: var(--primary);
      color: white;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-size: 1.8rem;
      margin: 0;
    }

    .user-info {
      font-size: 1rem;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }

    main {
      display: flex;
      justify-content: center;
      padding: 40px;
    }

    .form-wrapper {
      width: 100%;
      max-width: 1000px;
      background: var(--gray);
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px 30px;
    }

    label {
      font-weight: 600;
      padding-top: 10px;
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 14px 20px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover:not(:disabled) {
      background-color: #000f3a;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    #message {
      margin-top: 20px;
      padding: 12px;
      border-radius: 4px;
      font-weight: bold;
      display: none;
    }

    #message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    #message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .footer-btn {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 12px;
      margin-top: 20px;
      width: 100%;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .loading {
      text-align: center;
      color: #666;
      display: none;
    }

    @media (max-width: 768px) {
      .form-grid { grid-template-columns: 1fr; }
      header { flex-direction: column; gap: 10px; }
    }
  </style>
</head>
<body>

  <div id="header-placeholder"></div>

  <header>
    <h1>Admin Dashboard – Add School/University</h1>
    </div>
  </header>

  <main>
    <div class="form-wrapper">
      <form id="schoolForm" class="form-grid">

        <label for="name">School / University Name *:</label>
        <input type="text" id="name" required />

        <label for="address">Address *:</label>
<input type="text" id="address" placeholder="123 University Road" required />


        <label for="city">City:</label>
        <select id="city">
          <option value="">-- Select --</option>
          <option value="London">London</option>
          <option value="Oxford">Oxford</option>
          <option value="Cambridge">Cambridge</option>
          <option value="Manchester">Manchester</option>
          <option value="Birmingham">Birmingham</option>
          <option value="Glasgow">Glasgow</option>
          <option value="St Andrews">St Andrews</option>
          <option value="Edinburgh">Edinburgh</option>
          <option value="Liverpool">Liverpool</option>
          <option value="Bristol">Bristol</option>
          <option value="Leeds">Leeds</option>
          <option value="Sheffield">Sheffield</option>
          <option value="Newcastle">Newcastle</option>
          <option value="Nottingham">Nottingham</option>
          <option value="Southampton">Southampton</option>
          <option value="Portsmouth">Portsmouth</option>
          <option value="Brighton">Brighton</option>
          <option value="Plymouth">Plymouth</option>
          <option value="Cardiff">Cardiff</option>
          <option value="Bangor">Bangor</option>
          <option value="Aberystwyth">Aberystwyth</option>
          <option value="Belfast">Belfast</option>
          <option value="Coventry">Coventry</option>
          <option value="Hull">Hull</option>
          <option value="Dundee">Dundee</option>
          <option value="Aberdeen">Aberdeen</option>
          <option value="Inverness">Inverness</option>
          <option value="Swansea">Swansea</option>
          <option value="Reading">Reading</option>
          <option value="Leicester">Leicester</option>
          <option value="Bradford">Bradford</option>
        </select>

        <label for="lat">Latitude *:</label>
        <input type="number" id="lat" step="any" placeholder="51.5074" required />

        <label for="lng">Longitude *:</label>
        <input type="number" id="lng" step="any" placeholder="-0.1278" required />

        <label for="image">Upload School Image *:</label>
<input type="file" id="image" accept="image/*" required />

<label for="website">University Website Link *:</label>
<input type="url" id="website" placeholder="https://example.edu" required />


        <label for="description">About *:</label>
        <textarea id="description" required placeholder="Description of the school..."></textarea>

        <div class="full-width">
          <button type="submit" id="submitBtn">Add to Map</button>
          <div class="loading" id="loading">Adding school...</div>
          <div id="message"></div>
        </div>

        <div class="full-width">
          <button class="footer-btn" type="button" onclick="window.location.href='records.html'">View All Schools</button>
        </div>

      </form>
    </div>
  </main>

  <script>
// ===============================
// CITY → LAT/LNG AUTO-FILL MAP
// ===============================
const cityCoordinates = {
  "London": { lat: 51.5074, lng: -0.1278 },
  "Oxford": { lat: 51.7520, lng: -1.2577 },
  "Cambridge": { lat: 52.2053, lng: 0.1218 },
  "Manchester": { lat: 53.4808, lng: -2.2426 },
  "Birmingham": { lat: 52.4862, lng: -1.8904 },
  "Glasgow": { lat: 55.8642, lng: -4.2518 },
  "St Andrews": { lat: 56.3398, lng: -2.7967 },
  "Edinburgh": { lat: 55.9533, lng: -3.1883 },
  "Liverpool": { lat: 53.4084, lng: -2.9916 },
  "Bristol": { lat: 51.4545, lng: -2.5879 },
  "Leeds": { lat: 53.8008, lng: -1.5491 },
  "Sheffield": { lat: 53.3811, lng: -1.4701 },
  "Newcastle": { lat: 54.9784, lng: -1.6174 },
  "Nottingham": { lat: 52.9548, lng: -1.1581 },
  "Southampton": { lat: 50.9097, lng: -1.4044 },
  "Portsmouth": { lat: 50.8198, lng: -1.0880 },
  "Brighton": { lat: 50.8225, lng: -0.1372 },
  "Plymouth": { lat: 50.3755, lng: -4.1427 },
  "Cardiff": { lat: 51.4816, lng: -3.1791 },
  "Bangor": { lat: 53.2270, lng: -4.1294 },
  "Aberystwyth": { lat: 52.4153, lng: -4.0829 },
  "Belfast": { lat: 54.5973, lng: -5.9301 },
  "Coventry": { lat: 52.4068, lng: -1.5197 },
  "Hull": { lat: 53.7676, lng: -0.3274 },
  "Dundee": { lat: 56.4620, lng: -2.9707 },
  "Aberdeen": { lat: 57.1497, lng: -2.0943 },
  "Inverness": { lat: 57.4778, lng: -4.2247 },
  "Swansea": { lat: 51.6214, lng: -3.9436 },
  "Reading": { lat: 51.4543, lng: -0.9781 },
  "Leicester": { lat: 52.6369, lng: -1.1398 },
  "Bradford": { lat: 53.7950, lng: -1.7594 }
};

// ===============================
// HEADER LOAD (OPTIONAL)
// ===============================
fetch('header.html')
  .then(res => res.text())
  .then(html => {
    document.getElementById('header-placeholder').innerHTML = html;
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('nav-menu');
    if (hamburger && navMenu) {
      hamburger.addEventListener('click', () => {
        navMenu.classList.toggle('active');
        hamburger.classList.toggle('open');
      });
    }
  })
  .catch(err => console.error('Error loading header:', err));

// ===============================
// MAIN FORM SETUP
// ===============================
function setupForm() {
  const form = document.getElementById("schoolForm");
  const citySelect = document.getElementById("city");
  const latInput = document.getElementById("lat");
  const lngInput = document.getElementById("lng");
  const submitBtn = document.getElementById("submitBtn");
  const loading = document.getElementById("loading");
  const message = document.getElementById("message");

  // --- Auto-fill lat/lng when city changes (set once)
  citySelect.addEventListener('change', () => {
    const selected = citySelect.value;
    if (cityCoordinates[selected]) {
      latInput.value = cityCoordinates[selected].lat;
      lngInput.value = cityCoordinates[selected].lng;
    } else {
      latInput.value = '';
      lngInput.value = '';
    }
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Collect form values correctly with trimmed strings
    const name = document.getElementById("name").value.trim();
    const city = citySelect.value;
    const address = document.getElementById("address").value.trim();
    const website = document.getElementById("website").value.trim();
    const lat = parseFloat(latInput.value);
    const lng = parseFloat(lngInput.value);
    const description = document.getElementById("description").value.trim();
    const imageInput = document.getElementById("image");
    const imageFile = imageInput.files[0];

    // Validation
    if (!name || !city || !address || !description || isNaN(lat) || isNaN(lng) || !website || !imageFile) {
      showMessage('⚠️ Please fill in all required fields.', 'error');
      return;
    }

    if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
      showMessage('Invalid coordinates.', 'error');
      return;
    }

    submitBtn.disabled = true;
    loading.style.display = 'block';

    try {
      // Convert image file to Base64 string
      const imageBase64 = await toBase64(imageFile);

      const schoolData = {
        name,
        city,
        address,
        lat,
        lng,
        About: description,
        website,
        image: imageBase64,
        JoinedCRMProgram: new Date().toISOString()
      };

      // Save data grouped by city in localStorage
      const cityChildren = JSON.parse(localStorage.getItem('cityChildren')) || {};
      if (!cityChildren[city]) cityChildren[city] = [];
      cityChildren[city].push(schoolData);
      localStorage.setItem('cityChildren', JSON.stringify(cityChildren));

      showMessage(`✅ "${name}" added to map successfully!`, 'success');
      form.reset();
      latInput.value = '';
      lngInput.value = '';
    } catch (error) {
      console.error(error);
      showMessage('❌ Failed to add school: ' + error.message, 'error');
    } finally {
      submitBtn.disabled = false;
      loading.style.display = 'none';
    }
  });
}

// ===============================
// HELPER: Convert file → Base64
// ===============================
function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// ===============================
// HELPER: Show success/error
// ===============================
function showMessage(text, type) {
  const message = document.getElementById('message');
  message.textContent = text;
  message.className = type;
  message.style.display = 'block';
  setTimeout(() => { message.style.display = 'none'; }, 5000);
}

// ===============================
// INIT
// ===============================
window.addEventListener('load', setupForm);
</script>


</body>
</html>